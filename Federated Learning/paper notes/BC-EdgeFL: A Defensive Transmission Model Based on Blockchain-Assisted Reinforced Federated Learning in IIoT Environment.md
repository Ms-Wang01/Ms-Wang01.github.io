# BC-EdgeFL: A Defensive Transmission Model Based on Blockchain-Assisted Reinforced Federated Learning in IIoT Environment


## 目前存在的问题：
1. 目前的物联网架构主要采用物联网云模式。当 IIoT 中的大量物联网设备向云发送请求时，可能会导致网络拥塞，无法快速响应请求。
2. 云位于远端，它可能会花费很长时间来管理信息请求，以至于网络云无法提供更好的服务。
3. 云服务器可能会出于商业利益泄露用户隐私，因此，很难保证数据的可靠性和保密性。
4. 传统的集中式机器学习方法有两个主要缺点。一个是内存不足，这可能会导致不收敛等问题；二是训练时间不合理。

## 本文贡献
本文结合FL与区块链和EC的优点，提出了一种用于工业物联网数据传输的方法。它能有效地解决FL中的漏洞，保护数据信息。
1. 本文在网络边缘增加了一个边缘服务器用于数据传输。通过边缘服务器处理大量的云计算任务，可以大大减轻网络云的负担，加快数据处理的速度。此外，底层设备可以将更多的计算任务分配给计算资源丰富的边缘服务器，有效解决了很多计算能力较低的设备不适合FL的问题。
2. 采用区块链的分布式架构，将数据信息上传到区块链进行验证。通过这种架构，可以保证设备之间数据传输的完整性，可以大大提高数据通信的安全性。
3. 本文提出的数据传输方法将局部模型更新过程与移动设备独立完成的过程分离，实验表明，该模型的准确率可达98%。

## DATA TRANSMISSION MODEL
<img width="433" alt="image" src="https://user-images.githubusercontent.com/70552149/178561637-d4c22ea0-3d72-43ff-9f46-75cde8ed4905.png">
两个模块:本地数据传输模块和远程数据传输模块。
传输过程主要由三部分组成，即边缘设备、边缘服务器和云服务器。
局部模型是指在每个参与设备上训练的模型，全局模型是指由FL服务器聚合的模型。
FL training process：任务初始化、局部模型训练和更新、全局模型 聚集和更新。
（图中边缘设备相当于FL中的客户端，而云服务器相当于中央服务器。然后，通过下载和上传参数来更新模型。）

1. 训练前，云服务器将初始模型参数发送到边缘服务器，底层设备将从分配的服务器下载这些参数。1⃣️和2⃣️
2. 设备i使用模型较低层次的本地数据进行计算。每轮训练之前，通过first convolutional veil和pooling veil对原始信息进行操作。并将输出信息传输到边缘服务器。边缘服务器在获得设备的输出后，将这些信息汇集到另一个信息池中，作为其他层的输入。边缘服务器计算更新后的值，设备才能收到更新后的相应参数。根据新的参数更新局部模型(3⃣️)

3. 边缘设备将更新后的模型发送到附近的边缘服务器，并传输给区块链进行进一步的验证和聚合（4⃣️和5⃣️）
4. 云从区块链检索更新的模型，然后通过加权平均计算将本地模型聚合为全局模型（6⃣️） 经过加权平均计算得到全局的聚合更新参数。然后，cloud将参数返回给服务器。

In local data transmission module：边缘设备与边缘服务器之间进行通信，远程数据传输主要依靠边缘服务器和云。因此，物联网环境的边缘设备本身具有及时有效地分析和处理数据的决策能力和计算能力。此处引入区块链：
<img width="464" alt="image" src="https://user-images.githubusercontent.com/70552149/178623589-0682da57-5d17-4951-94dd-856f61057216.png">

（蓝色节点表示边缘设备，黄色节点表示边缘环境中的边缘服务器。服务器上有多个边缘设备。）
区块链的6个层次结构：

1) 数据层:封装了底层的数据块以及相关的数据加密和时间戳等基础数据和基本算法。
2) 网络层:网络层包括分布式网络机制、数据传输机制和数据验证机制。
3) 共识层:主要封装网络节点的各种共识算法。
4) 激励层:将经济因素融入区块链技术体系，主要包括经济激励的发放机制和分配机制。
5) 契约层:主要封装各种脚本、算法、智能契约，是区块链可编程特性的基础。
6) 应用层:封装了区块链的各种应用场景和案例。

本文主要使用区块链中的椭圆曲线数字签名算法(ECDSA)，通过签名过程和验证过程来保证数据信息的完整性。该算法对数字签名过程进行加密和签名，以防止信息被伪造。ECDSA是数字签名的ECC和DSA的组合。

在区块链层，边缘服务器将模型参数上传到区块链。每个参与的节点收集模型参数，加密签名，并将其打包到块中。采用POW共识机制确定节点间的块权值。获得区块权限的节点将区块广播给其他节点，其他节点确认区块中包含的交易是否有效，通过认证后加入区块链。当一台设备故障时，不影响其他设备的型号更新。每个设备都可以得到最新的全球更新模型，形成对设备的激励机制。激励机制可以提高参与者提供数据和更新网络模型参数的积极性。在边缘服务器上传到云服务器的过程中使用区块链。

## 算法实现
### Edge Local Update Algorithm.
<img width="489" alt="image" src="https://user-images.githubusercontent.com/70552149/178624597-3eabc06e-d151-440d-ac73-134f6596b040.png">
其中，xoutput表示边缘设备下层的输出，ylabel表示对应的数据标签，ω表示模型更新后的参数，batch为本地数据更新过程中边缘设备与边缘服务器之间需要进行本地通信的次数。

### Global Aggregation Algorithm.
当边缘设备和边缘服务器完成边缘本地更新过程后，边缘服务器将更新后的参数发送给聚合器。它计算聚合的加权算术平均值。
<img width="485" alt="image" src="https://user-images.githubusercontent.com/70552149/178625171-fe603ec4-5e79-4cfb-bdf1-31beb8b397ea.png">

在一次聚合迭代之后，云服务器需要判断是否需要FL。

模型的训练过程需要客户端的所有数据Di的参与。我们假设获得最佳模型需要对数据进行k次训练。它可以通过云数据中心中的测试数据集对模型进行测试。

如果测试期间的性能非常好，那么就没有必要继续阻止过拟合和额外计算的发生。

如果条件不满足，云服务器将继续重复整个过程，并将模型参数分配给边缘服务器进行下一轮。

